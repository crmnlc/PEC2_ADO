---
title: "Análisis de datos ómicos: Segunda Prueba de Evaluación Continua"
author: "Carmen Lebrero Cia"
date: "1/6/2020"
output: 
  bookdown::html_document2:
    theme: united
    toc: yes
    number_sections: true
    toc_depth: 3
    fig_caption: yes
urlcolor: blue
header-includes:
  - \usepackage{leading}
  - \leading{15pt}
editor_options: 
  chunk_output_type: console
bibliography: bibliografia.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<style>
body {
text-align: justify}
</style>

# Introducción y objetivos

La secuenciación de RNA (RNA-seq) es una técnica que ha emergido en los últimos años y que ha revolucionado las herramientas de la transcriptómica. Esta aproximación permite una medida más precisa de los niveles de transcritos y sus isoformas [@wang_gerstein_snyder_2009]. La RNA-seq es también utilizada en áreas como la genómica funcional o la biología del cáncer, donde es interesante estudiar niveles de expresión diferentes en condiciones biológicas distintas, por ejemplo el tratamiento o no tratamiento de unas células cancerosas.

A pesar de que el objetivo final de la RNA-seq puede ser el mismo que el de los microarrays, los métodos estadísticos computacionales utilizados para el análisis de los datos para cada una técnicas es distinto. *Bioconductor*, un repositorio de bioinformática, tiene paquetes que han sido desarrollados para el análisis de los archivos count, entre los que destacan: *DESeq*, *DESeq2*, *edgeR*, *baySeq* o *limma*.

Este documento presenta un ejemplo de análisis de RNA-seq realizado con R y Bioconductor. El objetivo de esta PEC es mostrar cómo realizar un proceso de análisis de datos de ultrasecuenciación y un informe dinámico en el que se ilustrará de forma didáctica el pipeline llevado a cabo.

## Estructura del documento

La estructura que seguirá el documento será una estructura básica de un trabajo científico organizada en: *Introducción y Objetivos*, *Materiales y Métodos*, *Resultados* y *Discusión*, aunque esta estructura será un poco laxa dado que el objetivo principal de la PEC es demostrar que podemos llevar a cabo el proceso de análisis, es decir, la metodología. Tras una introducción, pasaremos a una descripción del proceso de análisis (*workflow*) y los métodos y programas utilizados. A continuación se presentarán los resultados obtenidos en cada paso del análisis para finalizar con una discusión de los resultados obtenidos y las dificultades encontradas en el trabajo.

## Objetivos

El objetivo de este trabajo es realizar un análisis de datos de RNA-seq pertenecientes a un análisis de tejidos de tiroides para encontrar genes diferencialmente expresados en tres tipos de infiltración medidos en un total de 292 muestras pertenecientes a tres grupos: *Not infiltrated tissues* (NIT) con n=236, *Small focal filtrates* (SFI) con n=42 y *Extensive lymphoid infiltrates* (ELI) con n=14.

En este ejercicio se nos proporcionan los datos preprocesados en una tabla de contajes y, para garantizar que los datos de cada alumno son distintos, se pide extraer 30 muestras aleatoriamente, 10 de cada grupo mediante un *script* o código de R. El material de partida son dos archivos, el archivo "targets.csv" y el archivo "counts.csv". En el archivo targets podremos observar el grupo al que pertenece cada muestra en la columna "groups" y, obteniendo lo índices randomizados para 10 muestras de estos datos, obtener 10 muestras de cada grupo del archivo counts.

Una vez preparados los datos, realizaremos un análisis de expresión diferencial. Dado que hay tres grupos, podrían hacerse tres comparaciones: SFI-NIT, ELI-NIT y ELI-SFI.

Como objetivos secundarios fijamos familiarizarse con el uso del entorno de R/Bioconductor para el análisis estadístico de RNA-seq y mostrar los problemas estadísticos que encontramos en el análisis de datos de secuenciación.

# Materiales y métodos

## Etapas del análisis

El análisis se realizará siguiendo el procedimiento descrito en varios materiales facilitados por el profesor y otros encontrados mediante búsqueda bibliográfica entre los que destacan:

* Archivo *RNASeqBiocPipeline.html* en el que se describe el análisis de un RNA-seq utilizando Bioconductor. Este archivo ha sido facilitado por el profesor a través de un repositorio.
* Archivo *Statistical analysis of RNA-seq data.pdf*, facilitado por el profesor.Se trata de un tutorial de Análisis estadístico de datos de RNA-seq
* La página web [@web1]. Un *workflow* de expresión diferencial de genes a partir de datos  de RNA-seq utilizando paquetes de Bioconductor.
* El artículo [@oshlack2010] que se centra en ejemplos de análisis de RNA-seq que llevan a cabo procedimientos con softwares y metodologías de código abierto.

Si nos fijamos en la Figura \@ref(fig:fig1), nosotros empezaríamos nuestro *pipeline* a partir de la *Table of counts*, de ahí realizariamos el proceso de normalización de los datos, crearíamos la lista de genes diferencialmente expresados, llevaríamos a cabo un análisis de significación biológica (análisis de enriquecimiento) y dicutiriamos los resultados obtenidos.


```{r fig1, echo=FALSE, out.width='100%', fig.align='center', fig.cap="Visión general del proceso de detección de expresión diferencial de genes. A la izquierda podemos ver el proceso de forma más amplia y a la derecha el proceso bioinformático de fomra más detallada con cada una de las etapas en rojo y los métodos utilizados en azul [@pobre_arraiano_2018][@oshlack2010]."}
knitr::include_graphics("D:/Users/Carmen/Desktop/Carmen/Curso_2019-2020/Master_bioinformatica_bioestadistica/ADO/PEC2/imagen1.png")
```


## Métodos de análisis

En este caso no partiremos de los datos crudos devueltos por el secuenciador, es decir, no partiremos de un archivo en el que únicamente encontraremos los fragmentos de lecturas cortas. Por el contrario, partiremos de una matriz de conteos en la que ya tendremos las lecturas mapeadas y tendremos el número de lecturas para cada muestra y cada gen, pero antes realizaremos el muestreo aleatorio que se nos pedía en el enunciado para que cada alumno partiese de unos datos distintos. Construiremos un nuevo objeto que sea adecuado para el análisis posterior (``` DESeqDataSet ```).



### Herramientas y procedimientos bioinformáticos de análisis

Los análisis estadísticos se realizaron utilizando el lenguaje R y las librerías desarrolladas para el análisis de microarray en el proyecto de Bioconductor (www.bioconductor.org). El código siguiente se utilizópara instalar los paquetes de Bioconductor necesarios para el análisis:

```{r echo=TRUE, message=FALSE}
if(!require(BiocManager)) install.packages("BiocManager")
if(!require(airway)) BiocManager::install("airway")
if(!require(Rsamtools)) BiocManager::install("Rsamtools")
if(!require(GenomicFeatures)) BiocManager::install("GenomicFeatures")
if(!require(DESeq2)) BiocManager::install("DESeq2")
if(!require(apeglm)) BiocManager::install("apeglm")
if(!require(BiocParallel)) BiocManager::install("BiocParallel")
if(!require(genefilter)) BiocManager::install("genefilter")
if(!require(org.Hs.eg.db)) BiocManager::install("org.Hs.eg.db")
if(!require(AnnotationDbi)) BiocManager::install("AnnotationDbi")
if(!require(ReportingTools)) BiocManager::install("ReportingTools")
if(!require(RUVSeq)) BiocManager::install("RUVSeq")
if(!require(sva)) BiocManager::install("sva")
if(!require(Gviz)) BiocManager::install("Gviz")

if(!require(magrittr)) install.packages("magrittr", dep=TRUE)
if(!require(dplyr)) install.packages("dplyr", dep=TRUE)
if(!require(ggplot2)) install.packages("ggplot2", dep=TRUE)
if(!require(pheatmap)) install.packages("pheatmap", dep=TRUE)
if(!require(RColorBrewer)) install.packages("RColorBrewer", dep=TRUE)
if(!require(ggbeeswarm)) install.packages("ggbeeswarm", dep=TRUE)
```

# Obtención y lectura de los datos

## Los datos para el análisis

Los datos en los que se basan esta PEC se han obtenido a partir de un estudio obtenido del repositorio *Genotype Tissue Expression* (GTEx). Este repositorio se trata de un proyecto para construir una base de datos de investigación de expresión y regulación génica específica de cada tejido, conteniendo datos de 54 tejidos distintos recogidos de 1000 individuos distintos. En esta práctica nos centraremos en datos de expresión (RNA-seq) de un análisis de tiroides en donde se compara tres tipos de infiltración medido en un total de 292 muestras pertenecientes a los tres grupos que hemos citado en la introducción.

## Selección de muestras para el análisis

## Lectura de los datos

# Preprocesado: Exploración, Control de Calidad y Normalización

## Exploración y visualización

### Exploración estadística de los datos

### Control de calidad

### Archivos de los resultados del control de calidad

## Normalización y Filtraje

### Filtraje

### Archivos de los resultados normalizados

# Selección de genes diferencialmente expresados

## Seleccion básica de genes en una comparación entre dos grupos

### Cálculo de estadísticos de test y p-valores

### Selección de los genes [más] expresados diferencialmente

### Ajuste de p-valores para comparaciones múltiples

# Post-procesado de las listas de genes obtenidas

## Comparaciones múltiples

## Anotación de resultados

### Tablas de anotaciones sencillas

### Archivos de resultados con tablas hiperenlazables

## Visualización de los perfiles de expresión

## Análisis de la significación biológica (1): Análisis de enriquecimiento

## Análisis de la significación biológica (2): Expresión diferencial de conjuntos de genes

# Resumen de resultados y discusión

## Discusión

# Bibliografía
